<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Meal Plan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg:#f7f7f8; --card:#fff; --text:#0f172a; --muted:#475569; --border:#e5e7eb;
      --radius:14px; --shadow:0 6px 18px rgba(0,0,0,.06); --primary:#2563eb;
    }
    * { box-sizing:border-box }
    html,body { margin:0; height:100% }
    body {
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text); background:var(--bg);
    }
    .wrap { max-width:820px; margin:40px auto; padding:0 16px }

    header {
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom:16px; gap:12px;
    }
    h1 { margin:0; font-size:clamp(1.6rem,2.5vw+1rem,2.2rem) }
    .nav a { text-decoration:none; color:var(--primary); margin-left:12px; font-weight:600 }

    .card {
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:20px; margin-bottom:16px;
    }
    h2 { margin:0 0 12px; font-size:1.1rem; color:var(--muted) }
    .muted { color:var(--muted); font-size:0.9rem }

    table { width:100%; border-collapse:collapse; margin-top:8px }
    th, td { padding:8px 4px; text-align:left; font-size:0.95rem; vertical-align:top }
    th { border-bottom:1px solid var(--border); color:var(--muted); font-weight:600 }
    tr:nth-child(even) td { background:#f9fafb }
    .checkbox-cell { width:40px; text-align:center }

    .btn {
      display:inline-flex; align-items:center; justify-content:center;
      height:32px; padding:0 10px; font-size:0.85rem;
      font-weight:600; border-radius:10px;
      border:1px solid var(--primary); background:var(--primary); color:#fff; cursor:pointer;
    }
    .btn:active { transform:translateY(1px) }

    .btn-ghost {
      display:inline-flex; align-items:center; justify-content:center;
      height:28px; padding:0 8px; font-size:0.8rem;
      border-radius:999px; border:1px solid var(--border);
      background:#fff; color:var(--muted); cursor:pointer;
      margin:2px 0;
    }
    .btn-ghost span { margin-left:4px; }

    /* Scroll only inside the cookbook list */
    .cookbook-scroll {
      max-height:260px;
      overflow-y:auto;
      margin-top:8px;
    }

    /* Scroll inside the weekly plan if it grows tall */
    .plan-scroll {
      max-height:260px;
      overflow-y:auto;
      margin-top:8px;
    }
    .meal-btn{
      color:var(--primary);
      text-decoration:none;
      font-weight:600;
    }
    .meal-btn:hover{
      text-decoration:underline;
    }
      </style>
</head>
<body>
  <main class="wrap">
    <header>
      <h1>Meal Plan</h1>
      <nav class="nav">
        <a href="{{ url_for('home') }}">Home</a>
        <a href="{{ url_for('meals') }}">Cookbook</a>
      </nav>
    </header>

    <!-- One form for everything so checkboxes + buttons submit together -->
    <form method="post" action="{{ url_for('meal_plan') }}">

      <!-- Cookbook with scroll -->
      <section class="card">
        <h2>Cookbook</h2>
        <p class="muted">Check one or more meals. Then use the buttons below to add the selected meals into the weekly plan.</p>

        <div class="cookbook-scroll">
          <table>
            <thead>
              <tr>
                <th class="checkbox-cell"></th>
                <th>Meal</th>
                <th>Prep (min)</th>
                <th>Cook (min)</th>
              </tr>
            </thead>
            <tbody>
              {% if meals %}
                {% for m in meals %}
                  <tr>
                    <td class="checkbox-cell">
                      <input type="checkbox" name="selected_meals" value="{{ loop.index0 }}">
                    </td>
                    <td><a class="meal-btn" href="{{url_for('meal_detail_idx',idx=loop.index0)}}">{{m.name}}</a></td>
                    <td>{{ m.prep or '0' }}</td>
                    <td>{{ m.cook or '0' }}</td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="4" class="muted">No meals in the cookbook yet.</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- This Week's Plan: lunch + dinner with Add / Remove buttons -->
      <section class="card">
        <h2>This Week’s Plan</h2>
        <p class="muted">
          Click <strong>Add selected</strong> under Lunch or Dinner to add the checked cookbook meals to that slot.
          You can have multiple meals in each slot and remove them later.
        </p>

        <div class="plan-scroll">
          <table>
            <thead>
              <tr>
                <th>Day</th>
                <th>Lunch</th>
                <th>Dinner</th>
              </tr>
            </thead>
            <tbody>
              {% for day, slots in weekly_plan.items() %}
                <tr>
                  <td>{{ day }}</td>

                  <!-- Lunch cell -->
                  <td>
                    {% if slots.lunch %}
                      {% for idx, name in slots.lunch %}
                        <button class="btn-ghost" type="submit"
                                name="action"
                                value="remove:{{ day }}:lunch:{{ idx }}">
                          ✕ <span>{{ name }}</span>
                        </button><br>
                      {% endfor %}
                    {% else %}
                      <span class="muted">–</span><br>
                    {% endif %}
                    <!-- Add button for this day/slot -->
                    <button class="btn" type="submit"
                            name="action"
                            value="add:{{ day }}:lunch">
                      Add selected
                    </button>
                  </td>

                  <!-- Dinner cell -->
                  <td>
                    {% if slots.dinner %}
                      {% for idx, name in slots.dinner %}
                        <button class="btn-ghost" type="submit"
                                name="action"
                                value="remove:{{ day }}:dinner:{{ idx }}">
                          ✕ <span>{{ name }}</span>
                        </button><br>
                      {% endfor %}
                    {% else %}
                      <span class="muted">–</span><br>
                    {% endif %}
                    <!-- Add button for this day/slot -->
                    <button class="btn" type="submit"
                            name="action"
                            value="add:{{ day }}:dinner">
                      Add selected
                    </button>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

    </form>
  </main>
</body>
</html>
